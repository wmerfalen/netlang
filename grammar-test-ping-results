# Every minute run icmp echo request to all hosts on 192.168.1.* subnet
# Store results in 'uptime' postgres table
      
%include ".env"
crontab.run('* * * * *',[]() -> {
  icmp.echo_request('192.168.1.*') |=> [pg.uptime]
  icmp.echo_request('192.168.0.*') |=> [pg.uptime]
})

# Host the table results of uptime at /api/v1/uptime
https.host(
  '/api/v1/uptime',8080
) <=| [pg.uptime]

https.when('post','/api/v1/backup-db','singleton');

https.protect('/auth/') <=| [pg.session]
